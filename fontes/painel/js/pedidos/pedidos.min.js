$(document).ready(function(){reloadtableAll();reloadtableAll();verificaNovoPedido()});function reloadtableAll(){$("#divcat").load("ajax/pedidos/tab_pedidosAbertos.php",function(){});$("#producaodiv").load("ajax/pedidos/tab_pedidosEmProducao.php",function(){});$("#entregadiv").load("ajax/pedidos/tab_pedidosEntrega.php",function(){});$("#entregues").load("ajax/pedidos/tab_pedidosEntregues.php",function(){});$("#prontoss").load("ajax/pedidos/tab_prontos.php",function(){});$("#agretirada").load("ajax/pedidos/tab_agretirada.php",function(){});$("#canceladosdiv").load("ajax/pedidos/tab_cancelados.php",function(){});$("#devolvidosdiv").load("ajax/pedidos/tab_devolvidos.php",function(){})}function reloadtableAllPedido(){$("#divcat").load("ajax/pedidos/tab_pedidosAbertos.php",function(){})}document.addEventListener("DOMContentLoaded",function(){if(Notification.permission!=="granted"){Notification.requestPermission()}});function getprint(){var a=$("#guid").val();inprimir(a)}function inprimir(a){$.ajax({url:"ajax/pedidos/populate_pedidoAberto.php",type:"POST",data:"guid="+a,success:function(b){$.each(b,function(h,g){var f=g.guid;var o=g.status;var t=g.nome;var n=g.endereco;var d=g.total;var s=g.data;var i=g.telefone;var l=g.numero;var m=g.formaPagamento;var r=g.observacao;var k=g.cpf;var c=g.entregar;var e=g.token;var j=g.bairro;var q=0;if(o==1){var p="Processando"}if(m==0){q="Dinheiro"}else{q="Cartão/Crédito/Débito"}d=accounting.formatMoney(d,"",2,".",",");s=moment(s).format("DD/MM/YYYY");var u=new jsPDF();u.setFontSize(8);u.text(70,10,("Número Pedido: "+f));u.text(70,14,("Cliente: "+t));u.text(70,18,("Endereco: "+n));u.text(70,22,("Número: "+l));u.text(70,26,("Telefone: "+i));u.text(70,30,("Pagamento: "+q));u.text(70,34,("--------------------------------------------------------------------------"));$.ajax({url:"ajax/pedidos/addprodstolist.php",type:"POST",data:"pedido="+f,success:function(x){var w=34;$.each(x,function(z,A){var y=A.valorproduto;y=accounting.formatMoney(y,"R$ ",2,".",",");w=w+4;u.text(70,(w),((A.nomeproduto)+" | Preço: "+y))});u.text(70,(w+4),("--------------------------------------------------------------------------"));u.text(70,(w+8),("Total do Pedido: R$ "+d));var v=u.output("dataurlnewwindow")},error:function(v,x,w){alert("Status: "+x);alert("Error: "+w);console.log(arguments)}})})}})}function showAll(){$("#u2").show();$("#u3").show();$("#u4").show();$("#u5").show();$("#u6").show();$("#u7").show();$("#u8").show();$("#u9").show()}function openModal(f,l){var r=$("#modal");var s=$("#titulomodal");var t=$("#campoguid");var o=$("#botaoatualizar");var k=$("#optionSelected");var p=$("#guid");var c=$("#cat");var h=$("#token");var d=$("#data");var v=$("#total");var u=$("#enderecoo");var m=$("#numero");var j=$("#bairro");var b=$("#nome");var g=$("#telefone");var n=$("#pagamentoO");var a=$("#obss");var q=$("#total2");var i=$("#entregarR");var e=$("#troco");if(f=="editar"){$.ajax({url:"ajax/pedidos/populate_pedidoAberto.php",type:"POST",data:"guid="+l,success:function(w){$.each(w,function(D,B){var A=B.guid;var L=B.status;var Q=B.nome;var K=B.endereco;var y=B.total;var P=B.data;var E=B.telefone;var H=B.numero;var I=B.formaPagamento;var O=B.observacao;var G=B.cpf;var x=B.entregar;var z=B.token;var F=B.bairro;var N=0;var J=0;var C=B.troco;if(x==1){$("#u4").hide();J="Sim, Entegar"}else{$("#u4").show();J="Não, Virá Retirar na loja"}if(L==1){var M="Processando"}else{if(L==2){M="Em Produção";showAll();$("#u2").hide()}else{if(L==3){M="Pronto";showAll();$("#u3").hide()}else{if(L==4){M="Aguardando para busca";showAll();$("#u4").hide()}else{if(L==5){M="Saiu para Entrega";showAll();$("#u5").hide()}else{if(L==6){M="Entegue";showAll();$("#u6").hide()}else{if(L==7){M="Cliente não estava";showAll();$("#u7").hide()}else{if(L==8){M="Cancelado";showAll();$("#u8").hide()}else{if(L==9){M="Devolvido";showAll();$("#u9").hide()}}}}}}}}}if(I==0){N="Dinheiro"}else{N="Cartão/Crédito/Débito"}y=accounting.formatMoney(y,"",2,".",",");C=accounting.formatMoney(C,"R$ ",2,".",",");P=moment(P).format("DD/MM/YYYY");$("#formPedido")[0].reset();$("#formEndereco")[0].reset();$("#formaPagamento")[0].reset();k.val(L);k.html(M);e.val(C);v.val(y);h.val(z);d.val(P);u.val(K);m.val(H);j.val(F);b.val(Q);g.val(E);n.val(N);a.val(O);i.val(J);q.val(y)});s.html("Pedido #"+l);t.hide();o.show();p.val(l);addProdtolist(l,(j.val()));r.modal("show")}})}}function notifyMe(c){if(!Notification){alert("Desktop notifications not available in your browser. Try Chromium.");return}if(Notification.permission!=="granted"){Notification.requestPermission()}else{var d=new Notification(("Novo Pedido #"+c),{icon:"https://cdn0.iconfinder.com/data/icons/shop-payment-vol-4/128/shop-65-512.png",body:("Novo Pedido Realiazdo Número: "+c),});var a=document.getElementById("audio");var b="http://mobile.kingofeletro.com.br/android/painel/sound.mp3";a.src=b;a.play();d.onclick=function(){window.focus()};toastr.options={closeButton:true,debug:true,newestOnTop:true,progressBar:true,positionClass:"toast-top-right",preventDuplicates:true,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"60000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};toastr.info("Pedido Recebido, Num: "+c+" para visualizar clique <div><button type='button' onclick='openModal(\"editar\", "+c+");' class='btn btn-outline-info btn-sm'>Aqui</button>","Novo Pedido")}}function exportaPedido(b,a){$.ajax({url:"ajax/exportapedido.php",type:"POST",data:"pedido="+b+"&statusnext="+a,success:function(c){console.log(c)}})}function enviaEmail(b,a){$.ajax({url:"ajax/pedidos/enviaemail.php",type:"POST",data:"pedido="+b+"&statusnext="+a,success:function(c){console.log(c)}})}function salvar(a,b){var d=$("#cat").val();var c=$("#guid").val();exportaPedido(c,d);enviaEmail(c,d);$.ajax({url:"ajax/pedidos/pedido.php",type:"POST",data:"guidupdate="+c+"&categoria="+d+"&operacao="+a,success:function(e){$("#modal").modal("hide");if(e==1){toastr.success("Registro Deletado com Sucesso","OK")}else{toastr.success("Registro Salvo com Sucesso","OK")}reloadtableAll()}})}function abrirfechar(a){$.ajax({url:"ajax/abre_fecha/abrefecha.php",type:"POST",data:"operacao="+a,success:function(b){location.reload()}})}var timeout=setTimeout(verificaNovoPedido,2000);function verificaNovoPedido(){$.ajax({url:"ajax/pedidos/verificaNovoPedido.php",type:"POST",success:function(a){if(a!=0){notifyMe(a);reloadtableAllPedido()}}});timeout=setTimeout(verificaNovoPedido,2000)}function mesmo(a,c){var b=$("#qtdeListProd_"+a);$.ajax({url:"ajax/pedidos/mesmo.php",type:"POST",data:"produto="+a+"&pedido="+c,success:function(d){b.html(d)}})}function getBairroTax(b){var a=$("#listprods");$.ajax({url:"ajax/pedidos/taxa.php",type:"POST",data:"bairro="+b,success:function(d){var c=d;c=accounting.formatMoney(c,"R$ ",2,".",",");a.append(' <li class="list-group-item">Taxa de Entrega: '+c+" </li>")}})}function addProdtolist(c,b){var a=$("#listprods");$.ajax({url:"ajax/pedidos/addprodstolist.php",type:"POST",data:"pedido="+c,success:function(d){a.empty();$.each(d,function(g){var e=d.length;var f=d[g].valorproduto;f=accounting.formatMoney(f,"R$ ",2,".",",");for(var h=0;h<=e;h++){var k=d[g].guidproduto;var j=$("#idLIProd_"+k);if($(j,a).length){mesmo(k,c)}else{a.append('<li id="idLIProd_'+k+'" class="list-group-item">'+d[g].nomeproduto+" | Preço: "+f+'<span class="badge" id="qtdeListProd_'+k+'" >1</span></li>')}}});getBairroTax(b)},error:function(d,f,e){alert("Status: "+f);alert("Error: "+e);console.log(arguments)}})}$(function(){$("#supported").text("Supported/allowed: "+!!screenfull.enabled);if(!screenfull.enabled){return false}$("#toggle").click(function(){screenfull.toggle($("#container")[0])})});