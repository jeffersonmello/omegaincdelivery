$(document).ready(function(){reloadtableAll();reloadtableAll();verificaNovoPedido()});function reloadtableAll(){$("#divcat").load("ajax/pedidos/tab_pedidosAbertos.php",function(){});$("#producaodiv").load("ajax/pedidos/tab_pedidosEmProducao.php",function(){});$("#entregadiv").load("ajax/pedidos/tab_pedidosEntrega.php",function(){});$("#entregues").load("ajax/pedidos/tab_pedidosEntregues.php",function(){});$("#prontoss").load("ajax/pedidos/tab_prontos.php",function(){});$("#agretirada").load("ajax/pedidos/tab_agretirada.php",function(){});$("#canceladosdiv").load("ajax/pedidos/tab_cancelados.php",function(){});$("#devolvidosdiv").load("ajax/pedidos/tab_devolvidos.php",function(){})}function reloadtableAllPedido(){$("#divcat").load("ajax/pedidos/tab_pedidosAbertos.php",function(){})}document.addEventListener("DOMContentLoaded",function(){if(Notification.permission!=="granted"){Notification.requestPermission()}});function getprint(){var a=$("#guid").val();inprimir(a)}function inprimir(a){$.ajax({url:"ajax/pedidos/populate_pedidoAberto.php",type:"POST",data:"guid="+a,success:function(b){$.each(b,function(h,g){var f=g.guid;var o=g.status;var t=g.nome;var n=g.endereco;var d=g.total;var s=g.data;var i=g.telefone;var l=g.numero;var m=g.formaPagamento;var r=g.observacao;var k=g.cpf;var c=g.entregar;var e=g.token;var j=g.bairro;var q=0;if(o==1){var p="Processando"}if(m==0){q="Dinheiro"}else{q="Cartão/Crédito/Débito"}d=accounting.formatMoney(d,"",2,".",",");s=moment(s).format("DD/MM/YYYY");var u=new jsPDF();u.setFontSize(8);u.text(70,10,("Número Pedido: "+f));u.text(70,14,("Cliente: "+t));u.text(70,18,("Endereco: "+n));u.text(70,22,("Número: "+l));u.text(70,26,("Telefone: "+i));u.text(70,30,("Pagamento: "+q));u.text(70,34,("--------------------------------------------------------------------------"));$.ajax({url:"ajax/pedidos/addprodstolist.php",type:"POST",data:"pedido="+f,success:function(x){var w=34;$.each(x,function(z,A){var y=A.valorproduto;y=accounting.formatMoney(y,"R$ ",2,".",",");w=w+4;u.text(70,(w),((A.nomeproduto)+" | Preço: "+y))});u.text(70,(w+4),("--------------------------------------------------------------------------"));u.text(70,(w+8),("Total do Pedido: R$ "+d));var v=u.output("dataurlnewwindow")},error:function(v,x,w){alert("Status: "+x);alert("Error: "+w);console.log(arguments)}})})}})}function showAll(){$("#u2").show();$("#u3").show();$("#u4").show();$("#u5").show();$("#u6").show();$("#u7").show();$("#u8").show();$("#u9").show()}function openModal(e,k){var q=$("#modal");var r=$("#titulomodal");var s=$("#campoguid");var n=$("#botaoatualizar");var j=$("#optionSelected");var o=$("#guid");var c=$("#cat");var g=$("#token");var d=$("#data");var u=$("#total");var t=$("#enderecoo");var l=$("#numero");var i=$("#bairro");var b=$("#nome");var f=$("#telefone");var m=$("#pagamentoO");var a=$("#obss");var p=$("#total2");var h=$("#entregarR");if(e=="editar"){$.ajax({url:"ajax/pedidos/populate_pedidoAberto.php",type:"POST",data:"guid="+k,success:function(v){$.each(v,function(A){var z=v[A].guid;var I=v[A].status;var N=v[A].nome;var H=v[A].endereco;var x=v[A].total;var M=v[A].data;var B=v[A].telefone;var E=v[A].numero;var F=v[A].formaPagamento;var L=v[A].observacao;var D=v[A].cpf;var w=v[A].entregar;var y=v[A].token;var C=v[A].bairro;var K=0;var G=0;if(w==1){$("#u4").hide();G="Sim, Entegar"}else{$("#u4").show();G="Não, Virá Retirar na loja"}if(I==1){var J="Processando"}else{if(I==2){J="Em Produção";showAll();$("#u2").hide()}else{if(I==3){J="Pronto";showAll();$("#u3").hide()}else{if(I==4){J="Aguardando para busca";showAll();$("#u4").hide()}else{if(I==5){J="Saiu para Entrega";showAll();$("#u5").hide()}else{if(I==6){J="Entegue";showAll();$("#u6").hide()}else{if(I==7){J="Cliente não estava";showAll();$("#u7").hide()}else{if(I==8){J="Cancelado";showAll();$("#u8").hide()}else{if(I==9){J="Devolvido";showAll();$("#u9").hide()}}}}}}}}}if(F==0){K="Dinheiro"}else{K="Cartão/Crédito/Débito"}x=accounting.formatMoney(x,"",2,".",",");M=moment(M).format("DD/MM/YYYY");$("#formPedido")[0].reset();$("#formEndereco")[0].reset();$("#formaPagamento")[0].reset();j.val(I);j.html(J);u.val(x);g.val(y);d.val(M);t.val(H);l.val(E);i.val(C);b.val(N);f.val(B);m.val(K);a.val(L);h.val(G);p.val(x)});r.html("Pedido #"+k);s.hide();n.show();o.val(k);addProdtolist(k,(i.val()));q.modal("show")}})}}function notifyMe(c){if(!Notification){alert("Desktop notifications not available in your browser. Try Chromium.");return}if(Notification.permission!=="granted"){Notification.requestPermission()}else{var d=new Notification(("Novo Pedido #"+c),{icon:"https://cdn0.iconfinder.com/data/icons/shop-payment-vol-4/128/shop-65-512.png",body:("Novo Pedido Realiazdo Número: "+c),});var a=document.getElementById("audio");var b="http://mobile.kingofeletro.com.br/android/painel/sound.mp3";a.src=b;a.play();d.onclick=function(){window.focus()};toastr.options={closeButton:true,debug:true,newestOnTop:true,progressBar:true,positionClass:"toast-top-right",preventDuplicates:true,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"60000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};toastr.info("Pedido Recebido, Num: "+c+" para visualizar clique <div><button type='button' onclick='openModal(\"editar\", "+c+");' class='btn btn-outline-info btn-sm'>Aqui</button>","Novo Pedido")}}function exportaPedido(b,a){$.ajax({url:"ajax/exportapedido.php",type:"POST",data:"pedido="+b+"&statusnext="+a,success:function(c){console.log(c)}})}function enviaEmail(b,a){$.ajax({url:"ajax/pedidos/enviaemail.php",type:"POST",data:"pedido="+b+"&statusnext="+a,success:function(c){console.log(c)}})}function salvar(a,b){var d=$("#cat").val();var c=$("#guid").val();exportaPedido(c,d);enviaEmail(c,d);$.ajax({url:"ajax/pedidos/pedido.php",type:"POST",data:"guidupdate="+c+"&categoria="+d+"&operacao="+a,success:function(e){$("#modal").modal("hide");if(e==1){toastr.success("Registro Deletado com Sucesso","OK")}else{toastr.success("Registro Salvo com Sucesso","OK")}reloadtableAll()}})}function abrirfechar(a){$.ajax({url:"ajax/abre_fecha/abrefecha.php",type:"POST",data:"operacao="+a,success:function(b){location.reload()}})}var timeout=setTimeout(verificaNovoPedido,2000);function verificaNovoPedido(){$.ajax({url:"ajax/pedidos/verificaNovoPedido.php",type:"POST",success:function(a){if(a!=0){notifyMe(a);reloadtableAllPedido()}}});timeout=setTimeout(verificaNovoPedido,2000)}function mesmo(a,c){var b=$("#qtdeListProd_"+a);$.ajax({url:"ajax/pedidos/mesmo.php",type:"POST",data:"produto="+a+"&pedido="+c,success:function(d){b.html(d)}})}function getBairroTax(b){var a=$("#listprods");$.ajax({url:"ajax/pedidos/taxa.php",type:"POST",data:"bairro="+b,success:function(d){var c=d;c=accounting.formatMoney(c,"R$ ",2,".",",");a.append(' <li class="list-group-item">Taxa de Entrega: '+c+" </li>")}})}function addProdtolist(c,b){var a=$("#listprods");$.ajax({url:"ajax/pedidos/addprodstolist.php",type:"POST",data:"pedido="+c,success:function(d){a.empty();$.each(d,function(g){var e=d.length;var f=d[g].valorproduto;f=accounting.formatMoney(f,"R$ ",2,".",",");for(var h=0;h<=e;h++){var k=d[g].guidproduto;var j=$("#idLIProd_"+k);if($(j,a).length){mesmo(k,c)}else{a.append('<li id="idLIProd_'+k+'" class="list-group-item">'+d[g].nomeproduto+" | Preço: "+f+'<span class="badge" id="qtdeListProd_'+k+'" >1</span></li>')}}});getBairroTax(b)},error:function(d,f,e){alert("Status: "+f);alert("Error: "+e);console.log(arguments)}})}$(function(){$("#supported").text("Supported/allowed: "+!!screenfull.enabled);if(!screenfull.enabled){return false}$("#toggle").click(function(){screenfull.toggle($("#container")[0])})});